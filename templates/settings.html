{% extends "base.html" %}

{% block title %}Settings - FYE Meeting Recorder{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">Settings</h1>
    <p class="page-subtitle">Configure your meeting recorder preferences</p>
</div>

{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-{{ category }}">
            <span class="alert-icon">
                {% if category == 'success' %}‚úÖ{% elif category == 'error' %}‚ùå{% else %}‚ÑπÔ∏è{% endif %}
            </span>
            <span class="alert-message">{{ message }}</span>
        </div>
        {% endfor %}
    {% endif %}
{% endwith %}

<form method="POST" class="settings-form">
    <div class="settings-section">
        <div class="section-header">
            <span class="section-icon">üé•</span>
            <h3 class="section-title">Recording Settings</h3>
        </div>
        
        <div class="form-group">
            <label class="form-label" for="default_monitor">Default Monitor</label>
            <select class="form-select" name="default_monitor" id="default_monitor">
                {% for monitor in monitors %}
                <option value="{{ monitor.id }}" 
                        {% if current_user.default_monitor == monitor.id|string %}selected{% endif %}>
                    {{ monitor.name }}{% if monitor.primary %} (Primary){% endif %}
                </option>
                {% endfor %}
            </select>
            <div class="form-help">Choose which monitor to record by default</div>
        </div>
    </div>

    <div class="settings-section">
        <div class="section-header">
            <span class="section-icon">üìÅ</span>
            <h3 class="section-title">Storage Settings</h3>
        </div>
        
        <div class="form-group">
            <label class="form-label" for="auto_delete_days">Local Storage Retention</label>
            <select class="form-select" name="auto_delete_days" id="auto_delete_days">
                <option value="7" {% if current_user.auto_delete_days == 7 %}selected{% endif %}>7 days</option>
                <option value="14" {% if current_user.auto_delete_days == 14 %}selected{% endif %}>14 days</option>
                <option value="30" {% if current_user.auto_delete_days == 30 %}selected{% endif %}>30 days</option>
                <option value="60" {% if current_user.auto_delete_days == 60 %}selected{% endif %}>60 days</option>
                <option value="90" {% if current_user.auto_delete_days == 90 %}selected{% endif %}>90 days</option>
                <option value="0" {% if current_user.auto_delete_days == 0 %}selected{% endif %}>Keep forever</option>
            </select>
            <div class="form-help">How long to keep local recordings before automatic deletion (cloud backups are always retained)</div>
        </div>
        

    </div>

    <div class="form-actions">
        <button type="button" class="btn-secondary" onclick="resetForm()">
            <span>‚Ü∂</span>
            Cancel
        </button>
        <button type="submit" class="btn-primary">
            <span>üíæ</span>
            Save Settings
        </button>
    </div>
</form>

<style>
    .settings-form {
        max-width: 800px;
    }

    .alert {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.875rem 1rem;
        border-radius: 6px;
        margin-bottom: 1.5rem;
        font-size: 0.875rem;
    }

    .alert-success {
        background: #f0fdf4;
        border: 1px solid #bbf7d0;
        color: #166534;
    }

    .alert-error {
        background: #fef2f2;
        border: 1px solid #fecaca;
        color: #991b1b;
    }

    .alert-info {
        background: #eff6ff;
        border: 1px solid #bfdbfe;
        color: #1d4ed8;
    }

    .settings-section {
        background: white;
        border: 1px solid var(--gray-200);
        border-radius: 8px;
        margin-bottom: 1.5rem;
        box-shadow: var(--shadow-sm);
    }

    .section-header {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 1rem 1.25rem;
        border-bottom: 1px solid var(--gray-200);
        background: var(--gray-50);
        border-radius: 8px 8px 0 0;
    }

    .section-icon {
        font-size: 1.25rem;
    }

    .section-title {
        font-size: 1rem;
        font-weight: 600;
        color: var(--gray-900);
        margin: 0;
    }

    .form-group {
        padding: 1rem 1.25rem;
        border-bottom: 1px solid var(--gray-200);
    }

    .form-group:last-child {
        border-bottom: none;
    }

    .form-label {
        display: block;
        font-size: 0.875rem;
        font-weight: 500;
        color: var(--gray-700);
        margin-bottom: 0.5rem;
    }

    .form-select {
        width: 100%;
        max-width: 300px;
        padding: 0.5rem 0.75rem;
        border: 1px solid var(--gray-300);
        border-radius: 6px;
        font-size: 0.875rem;
        background: white;
        transition: border-color 0.2s;
    }

    .form-select:focus {
        outline: none;
        border-color: var(--secondary-blue);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .checkbox-group {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .form-checkbox {
        width: 1rem;
        height: 1rem;
        accent-color: var(--primary-blue);
    }

    .checkbox-label {
        font-size: 0.875rem;
        font-weight: 500;
        color: var(--gray-900);
        cursor: pointer;
    }

    .form-help {
        margin-top: 0.25rem;
        font-size: 0.75rem;
        color: var(--gray-500);
        line-height: 1.4;
    }

    .form-actions {
        display: flex;
        justify-content: flex-end;
        gap: 0.75rem;
        padding: 1.5rem 0;
    }

    @media (max-width: 768px) {
        .form-actions {
            flex-direction: column-reverse;
        }

        .form-select {
            max-width: none;
        }
    }
</style>

<script>
    function resetForm() {
        if (confirm('Are you sure you want to discard your changes?')) {
            location.reload();
        }
    }

    // Auto-save indicator
    let saveTimeout;
    const form = document.querySelector('.settings-form');
    const inputs = form.querySelectorAll('input, select');

    inputs.forEach(input => {
        input.addEventListener('change', function() {
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                // Could add auto-save functionality here
            }, 1000);
        });
    });
</script>
{% endblock %}