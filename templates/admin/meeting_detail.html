{% extends "base.html" %}

{% block title %}{{ meeting.subject }} - Meeting Details{% endblock %}

{% block extra_css %}
<style>
    body {
        background: #f8f9fa;
        min-height: 100vh;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    }

    .meeting-header {
        background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 50%, #2563eb 100%);
        color: white;
        padding: 1.2rem 0;
        margin: 0 -1rem 1.2rem -1rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    
    .meeting-header-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 1rem;
    }
    
    .meeting-title {
        font-size: 1.7rem;
        font-weight: 600;
        margin: 0 0 0.3rem 0;
        color: #f7e68c;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    .meeting-subtitle {
        color: rgba(255, 255, 255, 0.9);
        font-size: 0.94rem;
        margin: 0;
    }

    .content-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 1.5rem;
        margin-bottom: 1.5rem;
    }

    /* Compact styling for info cards */
    .compact-card {
        background: white;
        border-radius: 6px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        margin-bottom: 1rem;
    }

    .compact-header {
        background: #f9fafb;
        padding: 0.75rem 1rem;
        border-bottom: 1px solid #e5e7eb;
        font-weight: 600;
        color: #1f2937;
        font-size: 0.95rem;
    }

    .compact-content {
        padding: 1rem;
    }

    .compact-row {
        display: flex;
        justify-content: space-between;
        align-items: start;
        padding: 0.4rem 0;
        border-bottom: 1px solid #f9fafb;
        font-size: 0.85rem;
    }

    .compact-row:last-child {
        border-bottom: none;
    }

    .compact-label {
        font-weight: 500;
        color: #6b7280;
        min-width: 80px;
        font-size: 0.8rem;
    }

    .compact-value {
        color: #374151;
        text-align: right;
        flex: 1;
        font-size: 0.85rem;
    }

    .info-card {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        overflow: hidden;
    }

    .card-header {
        background: #f9fafb;
        padding: 1rem 1.5rem;
        border-bottom: 1px solid #e5e7eb;
        font-weight: 600;
        color: #1f2937;
        font-size: 1.1rem;
    }

    .card-content {
        padding: 1.5rem;
    }

    .info-row {
        display: flex;
        justify-content: space-between;
        align-items: start;
        padding: 0.75rem 0;
        border-bottom: 1px solid #f3f4f6;
    }

    .info-row:last-child {
        border-bottom: none;
    }

    .info-label {
        font-weight: 600;
        color: #374151;
        min-width: 120px;
    }

    .info-value {
        color: #6b7280;
        text-align: right;
        flex: 1;
    }

    .status-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        display: inline-block;
    }

    .status-recorded-synced {
        background: #d1fae5;
        color: #065f46;
    }

    .status-recorded-local {
        background: #fef3c7;
        color: #92400e;
    }

    .status-scheduled {
        background: #dbeafe;
        color: #1e40af;
    }

    .status-none {
        background: #f3f4f6;
        color: #6b7280;
    }

    .status-excluded {
        background: #fee2e2;
        color: #991b1b;
    }

    .attendees-grid {
        display: grid;
        gap: 0.75rem;
        margin-top: 1rem;
    }

    .attendee-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem;
        background: #f9fafb;
        border-radius: 6px;
        border: 1px solid #e5e7eb;
    }

    .attendee-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: #2563eb;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 1rem;
    }

    .attendee-info {
        flex: 1;
    }

    .attendee-name {
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 0.25rem;
    }

    .attendee-email {
        font-size: 0.875rem;
        color: #6b7280;
    }

    .attendee-type {
        padding: 0.125rem 0.5rem;
        background: #e5e7eb;
        color: #374151;
        border-radius: 4px;
        font-size: 0.75rem;
        font-weight: 500;
        text-transform: uppercase;
    }

    .attendee-type.organizer {
        background: #fef3c7;
        color: #92400e;
    }

    .attendee-type.required {
        background: #dbeafe;
        color: #1e40af;
    }

    .attendee-type.optional {
        background: #f3f4f6;
        color: #6b7280;
    }

    .recording-details {
        display: grid;
        gap: 1rem;
    }

    .recording-preview {
        background: #f9fafb;
        border-radius: 6px;
        padding: 1rem;
        border: 1px solid #e5e7eb;
        text-align: center;
    }

    .recording-icon {
        font-size: 3rem;
        margin-bottom: 0.5rem;
        color: #6b7280;
    }

    .recording-title {
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 0.5rem;
    }

    .recording-meta {
        font-size: 0.875rem;
        color: #6b7280;
        line-height: 1.5;
    }

    .action-buttons {
        display: flex;
        gap: 0.75rem;
        margin-bottom: 2rem;
        flex-wrap: wrap;
    }

    .btn {
        padding: 0.5rem 1rem;
        border-radius: 6px;
        font-weight: 600;
        text-decoration: none;
        border: none;
        cursor: pointer;
        font-size: 0.875rem;
        transition: all 0.2s;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    .btn-primary {
        background: #2563eb;
        color: white;
    }

    .btn-primary:hover {
        background: #1d4ed8;
        color: white;
        text-decoration: none;
    }

    .btn-secondary {
        background: #6b7280;
        color: white;
    }

    .btn-secondary:hover {
        background: #4b5563;
        color: white;
        text-decoration: none;
    }

    .btn-success {
        background: #059669;
        color: white;
    }

    .btn-success:hover {
        background: #047857;
        color: white;
        text-decoration: none;
    }

    .btn-success:disabled {
        background: #9ca3af;
        cursor: not-allowed;
        opacity: 0.6;
    }

    .btn-warning {
        background: #d97706;
        color: white;
    }

    .btn-warning:hover {
        background: #b45309;
        color: white;
        text-decoration: none;
    }

    .timeline-item {
        padding: 1rem 0;
        border-bottom: 1px solid #f3f4f6;
        display: flex;
        gap: 1rem;
    }

    .timeline-item:last-child {
        border-bottom: none;
    }

    .timeline-icon {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: #e5e7eb;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.875rem;
        flex-shrink: 0;
    }

    .timeline-content {
        flex: 1;
    }

    .timeline-title {
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 0.25rem;
    }

    .timeline-time {
        font-size: 0.75rem;
        color: #6b7280;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .link-recording-form {
        background: #f9fafb;
        border-radius: 6px;
        padding: 1rem;
        border: 1px solid #e5e7eb;
        margin-top: 1rem;
    }

    .form-group {
        margin-bottom: 1rem;
    }

    .form-label {
        display: block;
        font-weight: 600;
        color: #374151;
        margin-bottom: 0.5rem;
    }

    .form-select {
        width: 100%;
        padding: 0.5rem;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        background: white;
        color: #1f2937;
    }

    .no-recording-message {
        text-align: center;
        padding: 2rem;
        color: #6b7280;
        background: #f9fafb;
        border-radius: 6px;
        border: 1px solid #e5e7eb;
    }

    .teams-link {
        background: #5b21b6;
        color: white;
        padding: 0.75rem 1rem;
        border-radius: 6px;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: 600;
    }

    .teams-link:hover {
        background: #4c1d95;
        color: white;
        text-decoration: none;
    }

    /* Video Player Styles */
    .video-player-container {
        background: #000;
        border-radius: 8px;
        overflow: hidden;
        margin-bottom: 1rem;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        max-width: 100%;
    }

    .recording-video-player {
        width: 100%;
        height: auto;
        max-height: 300px;
        min-height: 200px;
        display: block;
        outline: none;
    }

    .video-controls {
        background: linear-gradient(to bottom, rgba(0,0,0,0.7), rgba(0,0,0,0.9));
        padding: 1rem;
        color: white;
    }

    .video-meta {
        font-size: 0.875rem;
        line-height: 1.4;
    }

    .video-meta strong {
        color: #f7e68c;
        display: block;
        margin-bottom: 0.5rem;
    }

    /* Transcript Viewer Styles */
    .transcript-viewer-container {
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        background: #f9fafb;
        margin-bottom: 1rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .transcript-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        border-bottom: 1px solid #e5e7eb;
        background: white;
        border-radius: 8px 8px 0 0;
    }

    .transcript-header h4 {
        margin: 0;
        font-size: 1rem;
        font-weight: 600;
        color: #1f2937;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .transcript-controls {
        display: flex;
        gap: 0.5rem;
    }

    .btn-small {
        padding: 0.375rem 0.75rem;
        font-size: 0.75rem;
        border-radius: 6px;
        border: 1px solid #d1d5db;
        background: white;
        color: #374151;
        text-decoration: none;
        cursor: pointer;
        transition: all 0.2s;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
    }

    .btn-small:hover {
        background: #f3f4f6;
        border-color: #9ca3af;
        text-decoration: none;
        color: #1f2937;
        transform: translateY(-1px);
    }

    .btn-small.cloud-btn {
        background: #3b82f6;
        color: white;
        border-color: #2563eb;
    }

    .btn-small.cloud-btn:hover {
        background: #2563eb;
        color: white;
        border-color: #1d4ed8;
    }

    .transcript-content {
        max-height: 250px;
        overflow-y: auto;
        padding: 1rem;
        background: white;
        border-radius: 0 0 8px 8px;
        display: none;
        line-height: 1.4;
        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        font-size: 0.8rem;
    }

    .transcript-content.show {
        display: block;
    }

    .transcript-loading {
        text-align: center;
        color: #9ca3af;
        font-style: italic;
        padding: 1.5rem;
        font-size: 0.85rem;
    }

    .transcript-text {
        line-height: 1.5;
        color: #6b7280;
        white-space: pre-wrap;
        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        margin-bottom: 0.5rem;
        padding: 0.2rem 0;
        font-size: 0.8rem;
        text-transform: none !important; /* Force no text transformation */
    }

    .transcript-timestamp {
        color: #2563eb;
        font-size: 0.7rem;
        font-weight: 600;
        margin: 0.75rem 0 0.3rem 0;
        border-top: 1px solid #f3f4f6;
        padding-top: 0.3rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    }

    .transcript-timestamp:first-child {
        margin-top: 0;
        border-top: none;
        padding-top: 0;
    }

    /* Download buttons */
    .download-buttons {
        display: flex;
        gap: 0.5rem;
        margin-top: 1rem;
    }

    .btn-download {
        padding: 12px 20px;
        font-size: 14px;
        font-weight: 500;
        border-radius: 8px;
        border: 1px solid #d1d5db;
        background: linear-gradient(145deg, #ffffffff, #ddddddff);
        color: #374151;
        text-decoration: none;
        cursor: pointer;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        margin: 0 6px 8px 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    }

    .btn-download:hover {
        background: linear-gradient(145deg, #f8fafc, #f1f5f9);
        border-color: #9ca3af;
        text-decoration: none;
        color: #1f2937;
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.12);
    }

    .download-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 0;
        margin: 16px 0;
        justify-content: flex-start;
    }

    @media (max-width: 768px) {
        .content-grid {
            grid-template-columns: 1fr;
            gap: 1rem;
        }
        
        .action-buttons {
            flex-direction: column;
        }
        
        .btn {
            text-align: center;
        }

        .recording-video-player {
            max-height: 250px;
        }

        .transcript-header {
            flex-direction: column;
            gap: 0.5rem;
            align-items: flex-start;
        }

        .transcript-controls {
            width: 100%;
            justify-content: flex-end;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="meeting-header">
    <div class="meeting-header-content">
        <h1 class="meeting-title">{{ meeting.subject }}</h1>
        <p class="meeting-subtitle">
            📅 {{ meeting.start_time.strftime('%A, %B %d, %Y') }} • 
            ⏰ {{ meeting.start_time.strftime('%H:%M') }} - {{ meeting.end_time.strftime('%H:%M') }} •
            ⏱️ {{ meeting.duration_formatted }}
        </p>
    </div>
</div>

<div class="action-buttons">
    <a href="{{ url_for('admin_meetings') }}" class="btn btn-secondary">
        ← Back to Meetings
    </a>
    {% if meeting.recording %}
    <a href="{{ url_for('admin_recording_detail', recording_id=meeting.recording.id) }}" class="btn btn-primary">
        📹 View Recording
    </a>
    {% else %}
    <button id="recordButton" class="btn btn-success" onclick="startMeetingRecording()">
        Record Meeting
    </button>
    {% endif %}
</div>

<div class="content-grid">
    <!-- Recording Column (First and Wider) -->
    <div class="recording-column">
        <!-- Recording Information -->
        <div class="info-card">
            <div class="card-header">📹 Recording</div>
            <div class="card-content">
                {% if meeting.recording %}
                <div class="recording-details">
                    <!-- Local Video Player Section (Priority) -->
                    {% if meeting.recording.file_exists %}
                    <div class="video-player-container">
                        <video controls class="recording-video-player" preload="metadata">
                            <source src="{{ url_for('serve_recording', recording_id=meeting.recording.id) }}" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                        <div class="video-controls">
                            <div class="video-meta">
                                <strong>{{ meeting.recording.title }}</strong><br>
                                Duration: {{ format_duration(meeting.recording.duration) }} • 
                                Size: {{ format_file_size(meeting.recording.file_size) }} • 
                                <span style="color: #10b981;">Local File</span>
                            </div>
                        </div>
                    </div>
                    {% elif meeting.recording.cloud_video_url %}
                    <div class="recording-preview">
                        <div class="recording-icon">🎬</div>
                        <div class="recording-title">{{ meeting.recording.title }}</div>
                        <div class="recording-meta">
                            <strong>Duration:</strong> {{ format_duration(meeting.recording.duration) }}<br>
                            <strong>Size:</strong> {{ format_file_size(meeting.recording.file_size) }}<br>
                            <strong>Status:</strong> Local file not available, cloud backup only
                        </div>
                    </div>
                    {% else %}
                    <div class="recording-preview">
                        <div class="recording-icon">🎬</div>
                        <div class="recording-title">{{ meeting.recording.title }}</div>
                        <div class="recording-meta">
                            <strong>Duration:</strong> {{ format_duration(meeting.recording.duration) }}<br>
                            <strong>Size:</strong> {{ format_file_size(meeting.recording.file_size) }}<br>
                            <strong>Status:</strong> {{ meeting.recording.upload_status or 'Unknown' }}<br>
                            <strong>Created:</strong> {{ meeting.recording.created_at.strftime('%Y-%m-%d %H:%M') if meeting.recording.created_at else 'N/A' }}
                        </div>
                    </div>
                    {% endif %}
                    
                    <!-- Local Transcript Viewer Section (Priority) -->
                    {% if meeting.recording.has_transcript %}
                    <div class="transcript-viewer-container">
                        <div class="transcript-header">
                            <h4>📝 Meeting Transcript</h4>
                            <div class="transcript-controls">
                                <button id="toggleTranscript" class="btn-small">Show</button>
                            </div>
                        </div>
                        <div id="transcriptContent" class="transcript-content">
                            <div class="transcript-loading">Loading local transcript...</div>
                        </div>
                    </div>
                    {% elif meeting.recording.cloud_transcript_url %}
                    <div class="transcript-viewer-container">
                        <div class="transcript-header">
                            <h4>📝 Meeting Transcript (Cloud Backup)</h4>
                            <div class="transcript-controls">
                                <button id="toggleTranscript" class="btn-small">Show</button>
                            </div>
                        </div>
                        <div id="transcriptContent" class="transcript-content">
                            <div class="transcript-loading">Loading transcript from cloud...</div>
                        </div>
                    </div>
                    {% endif %}
                    
                    <!-- Download Buttons -->
                    <div class="download-buttons">
                        {% if meeting.recording.file_exists or meeting.recording.cloud_video_url %}
                        <a href="{{ url_for('serve_recording', recording_id=meeting.recording.id) if meeting.recording.file_exists else meeting.recording.cloud_video_url }}" target="_blank" class="btn-download">
                            Video ⬇️
                        </a>
                        {% endif %}
                        {% if meeting.recording.has_transcript or meeting.recording.cloud_transcript_url %}
                        <a href="{{ url_for('serve_transcript', recording_id=meeting.recording.id) if meeting.recording.has_transcript else meeting.recording.cloud_transcript_url }}" target="_blank" class="btn-download">
                            Transcript ⬇️
                        </a>
                        {% endif %}
                    </div>
                    
                    <a href="{{ url_for('admin_recording_detail', recording_id=meeting.recording.id) }}" class="btn btn-primary" style="width: 100%; justify-content: center; margin-top: 1rem;">
                        📹 View Recording Details
                    </a>
                </div>
                {% else %}
                <div class="no-recording-message">
                    <p>📭 No recording for this meeting</p>
                    <p style="font-size: 0.8rem; color: #9ca3af; margin-top: 0.5rem;">
                        Use the "                            Transcript ⬇️" button above to start recording
                    </p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Info Column (Second, Compact) -->
    <div class="info-column">
        <!-- Compact Meeting & Attendees Information -->
        <div class="compact-card">
            <div class="compact-header">📋 Meeting & Attendees</div>
            <div class="compact-content">
                <div class="compact-row">
                    <span class="compact-label">Subject:</span>
                    <span class="compact-value">{{ meeting.subject }}</span>
                </div>
                <div class="compact-row">
                    <span class="compact-label">Start:</span>
                    <span class="compact-value">{{ meeting.start_time.strftime('%m/%d %H:%M') }}</span>
                </div>
                <div class="compact-row">
                    <span class="compact-label">End:</span>
                    <span class="compact-value">{{ meeting.end_time.strftime('%m/%d %H:%M') }}</span>
                </div>
                <div class="compact-row">
                    <span class="compact-label">Duration:</span>
                    <span class="compact-value">{{ meeting.duration_formatted }}</span>
                </div>
                <div class="compact-row">
                    <span class="compact-label">Status:</span>
                    <span class="compact-value">
                        <span class="status-badge {{ meeting.status_class }}">{{ meeting.status_display }}</span>
                    </span>
                </div>
                <div class="compact-row">
                    <span class="compact-label">Teams:</span>
                    <span class="compact-value">{{ 'Yes' if meeting.web_link else 'No' }}</span>
                </div>
                <div class="compact-row">
                    <span class="compact-label">Location:</span>
                    <span class="compact-value">{{ meeting.location or 'N/A' }}</span>
                </div>
                <div class="compact-row">
                    <span class="compact-label">Attendees:</span>
                    <span class="compact-value">{{ meeting.attendee_count }}</span>
                </div>
                {% if meeting.all_attendees and meeting.all_attendees|length > 0 %}
                <div style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid #f3f4f6;">
                    {% for attendee in meeting.all_attendees %}
                    <div style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.25rem;">
                        {{ attendee.split('@')[0] if '@' in attendee else attendee }}
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="compact-card">
            <div class="compact-header">⚡ Quick Actions</div>
            <div class="compact-content">
                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                    {% if meeting.recording %}
                    <form method="POST" action="{{ url_for('admin_unlink_recording', meeting_id=meeting.id) }}" onsubmit="return confirm('Are you sure you want to unlink this recording?')">
                        <button type="submit" class="btn btn-warning" style="width: 100%; justify-content: center; padding: 0.5rem; font-size: 0.8rem;">
                            🔗❌ Unlink Recording
                        </button>
                    </form>
                    {% endif %}
                    
                    <form method="POST" action="{{ url_for('admin_delete_meeting', meeting_id=meeting.id) }}" onsubmit="return confirm('Are you sure you want to delete this meeting? This action cannot be undone.')">
                        <button type="submit" class="btn" style="background: #dc2626; color: white; width: 100%; justify-content: center; padding: 0.5rem; font-size: 0.8rem;">
                            🗑️ Delete Meeting
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
    function startMeetingRecording() {
        const button = document.getElementById('recordButton');
        const originalText = button.innerHTML;
        
        // Disable button and show loading state
        button.disabled = true;
        button.innerHTML = '⏳ Starting Recording...';
        
        // Prepare recording data
        const recordingData = {
            title: '{{ meeting.subject | replace("'", "\\'") }} - {{ meeting.start_time.strftime("%Y-%m-%d %H:%M") }}',
            meeting_id: {{ meeting.id }}
        };
        
        // Start recording
        fetch('/start', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(recordingData)
        })
        .then(response => response.json())
        .then(data => {
            if (data.success || data.recording_id) {
                // Success - redirect to recordings page or refresh
                alert('✅ Recording started successfully!');
                window.location.reload();
            } else {
                // Error
                alert('❌ Failed to start recording: ' + (data.error || 'Unknown error'));
                button.disabled = false;
                button.innerHTML = originalText;
            }
        })
        .catch(error => {
            console.error('Error starting recording:', error);
            alert('❌ Failed to start recording: ' + error.message);
            button.disabled = false;
            button.innerHTML = originalText;
        });
    }

    // Transcript viewer functionality
    document.addEventListener('DOMContentLoaded', function() {
        const toggleButton = document.getElementById('toggleTranscript');
        const transcriptContent = document.getElementById('transcriptContent');
        
        if (toggleButton && transcriptContent) {
            // Load transcript content
            loadTranscript();
            
            // Toggle transcript visibility
            toggleButton.addEventListener('click', function() {
                transcriptContent.classList.toggle('show');
                
                if (transcriptContent.classList.contains('show')) {
                    toggleButton.textContent = 'Hide';
                } else {
                    toggleButton.textContent = 'Show';
                }
            });
        }
    });

    function loadTranscript() {
        const transcriptContent = document.getElementById('transcriptContent');
        if (!transcriptContent) return;

        {% if meeting.recording %}
        {% if meeting.recording.has_transcript %}
        // Load from LOCAL transcript file first (priority)
        fetch('/admin/recordings/{{ meeting.recording.id }}/transcript')
            .then(response => response.text())
            .then(data => {
                displayTranscript(data);
            })
            .catch(error => {
                console.error('Error loading local transcript:', error);
                {% if meeting.recording.cloud_transcript_url %}
                // Fallback to cloud if local fails
                fetch('{{ meeting.recording.cloud_transcript_url }}')
                    .then(response => response.text())
                    .then(data => {
                        displayTranscript(data);
                    })
                    .catch(cloudError => {
                        console.error('Error loading cloud transcript:', cloudError);
                        transcriptContent.innerHTML = '<div class="transcript-loading">Failed to load transcript from both local and cloud sources.</div>';
                    });
                {% else %}
                transcriptContent.innerHTML = '<div class="transcript-loading">Failed to load local transcript.</div>';
                {% endif %}
            });
        {% elif meeting.recording.cloud_transcript_url %}
        // Load from cloud URL (fallback only)
        fetch('{{ meeting.recording.cloud_transcript_url }}')
            .then(response => response.text())
            .then(data => {
                displayTranscript(data);
            })
            .catch(error => {
                console.error('Error loading cloud transcript:', error);
                transcriptContent.innerHTML = '<div class="transcript-loading">Failed to load transcript from cloud.</div>';
            });
        {% else %}
        transcriptContent.innerHTML = '<div class="transcript-loading">No transcript available.</div>';
        {% endif %}
        {% endif %}
    }

    function displayTranscript(transcriptText) {
        const transcriptContent = document.getElementById('transcriptContent');
        if (!transcriptContent || !transcriptText) return;

        // SIMPLE: Just show the raw transcript text as-is
        transcriptContent.innerHTML = `<pre style="font-family: Consolas, monospace; font-size: 14px; line-height: 1.5; color: #333; white-space: pre-wrap; margin: 0; padding: 10px; background: #f9f9f9; border-radius: 4px;">${transcriptText}</pre>`;
    }
</script>
{% endblock %}